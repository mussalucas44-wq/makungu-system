<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Makungu Group · Financial System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"></script>
  <style>
    .tab-btn.active { background-color: #3b82f6; color: white; }
    .card-hover { transition: all 0.2s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
    #login-container, #app-container { transition: opacity 0.3s ease; }
    .status-badge { @apply px-2 py-1 text-xs rounded-full font-medium; }
    .status-pending { @apply bg-yellow-100 text-yellow-800; }
    .status-approved { @apply bg-green-100 text-green-800; }
    .status-rejected { @apply bg-red-100 text-red-800; }
  </style>
</head>
<body class="bg-gray-50 font-sans antialiased">

<!-- LOGIN SCREEN -->
<div id="login-container" class="fixed inset-0 flex items-center justify-center bg-gray-100 z-50">
  <div class="bg-white p-8 rounded-xl shadow-lg w-96">
    <div class="flex justify-center mb-4">
      <img src="logo.png" alt="Makungu Group Logo" class="h-16 w-auto" onerror="this.style.display='none'">
    </div>
    <h1 class="text-4xl font-bold mb-2 text-center bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-transparent bg-clip-text">
      Makungu Group
    </h1>
    <p class="text-center text-gray-500 mb-6 text-lg font-semibold">Financial System · Login</p>
    <form id="login-form">
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input type="email" id="email" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
      </div>
      <div class="mb-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
      </div>
      <div class="text-right mb-6">
        <button type="button" id="forgot-password-btn" class="text-sm text-blue-600 hover:underline">Forgot password?</button>
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-semibold">Sign In</button>
    </form>
  </div>
</div>

<!-- MAIN APPLICATION -->
<div id="app-container" class="hidden">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-lg flex flex-col">
      <div class="p-5 border-b flex items-center space-x-3">
        <img src="logo.png" alt="Logo" class="h-8 w-8 rounded-full" onerror="this.style.display='none'">
        <div>
          <h1 class="text-2xl font-bold text-gray-800">Makungu Group</h1>
          <p class="text-sm text-gray-500">Financial System</p>
        </div>
      </div>
      <nav class="flex-1 p-4 space-y-1">
        <button id="nav-dashboard" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-home text-gray-500"></i><span>Dashboard</span>
        </button>
        <button id="nav-vouchers" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-receipt text-gray-500"></i><span>Vouchers</span>
        </button>
        <button id="nav-journals" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-book text-gray-500"></i><span>Journals</span>
        </button>
        <button id="nav-users" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-users text-gray-500"></i><span>Users</span>
        </button>
      </nav>
      <div class="p-4 border-t">
        <div class="mb-2 px-2 text-sm text-gray-600">
          <i class="fas fa-user-circle mr-1"></i> Logged in as <span id="user-email-display"></span> (<span id="user-role-display"></span>)
        </div>
        <button id="logout-btn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg flex items-center space-x-3">
          <i class="fas fa-sign-out-alt"></i><span>Logout</span>
        </button>
      </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
      <div id="content-area"></div>
    </main>
  </div>
</div>

<!-- BACKEND-CONNECTED SCRIPT -->
<script>
const API_URL = 'https://makungu-backend-v2.onrender.com/api';

let currentUser = null;
let users = [];
let vouchers = [];
let journals = [];

// ================== LOGIN ==================
function showApp() {
  document.getElementById('login-container').classList.add('hidden');
  document.getElementById('app-container').classList.remove('hidden');
  document.getElementById('user-email-display').innerText = currentUser.email;
  document.getElementById('user-role-display').innerText = currentUser.role;
  renderDashboard();
  fetchUsers();
}

function showLogin() {
  document.getElementById('login-container').classList.remove('hidden');
  document.getElementById('app-container').classList.add('hidden');
  currentUser = null;
}

document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  try {
    const res = await fetch(`${API_URL}/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (data.success) {
      currentUser = data.user;
      showApp();
    } else {
      alert(data.message || 'Invalid credentials');
    }
  } catch(err) {
    console.error(err);
    alert('Login failed');
  }
});

document.getElementById('logout-btn').addEventListener('click', showLogin);

// ================== NAVIGATION ==================
document.getElementById('nav-dashboard').addEventListener('click', renderDashboard);
document.getElementById('nav-users').addEventListener('click', renderUsersPage);
document.getElementById('nav-vouchers').addEventListener('click', renderVouchersPage);
document.getElementById('nav-journals').addEventListener('click', renderJournalsPage);

function clearActiveTab(){
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
}
function setActiveTab(tabId){
  clearActiveTab();
  document.getElementById(tabId).classList.add('active');
}

// ================== DASHBOARD ==================
function renderDashboard() {
  setActiveTab('nav-dashboard');
  document.getElementById('content-area').innerHTML = `
    <h2 class="text-3xl font-bold mb-4">Dashboard</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Users</h3>
        <p class="text-2xl font-bold">${users.length}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Vouchers</h3>
        <p class="text-2xl font-bold">${vouchers.length}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Journals</h3>
        <p class="text-2xl font-bold">${journals.length}</p>
      </div>
    </div>
  `;
}

// ================== USERS ==================
async function fetchUsers() {
  if (currentUser.role !== 'admin') return;
  try {
    const res = await fetch(`${API_URL}/users?adminEmail=${currentUser.email}`);
    users = await res.json();
    renderUsersPage();
  } catch(err){ console.error(err); }
}

function renderUsersPage() {
  setActiveTab('nav-users');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Users Management</h2>`;
  if(currentUser.role==='admin'){
    html += `
      <div class="mb-4 flex space-x-2">
        <input type="email" id="new-user-email" placeholder="Email" class="border px-3 py-2 rounded-lg">
        <select id="new-user-role" class="border px-3 py-2 rounded-lg">
          <option value="staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
        <button onclick="addUser()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add User</button>
      </div>`;
  }
  html += `<table class="w-full text-left border rounded-lg overflow-hidden">
    <thead class="bg-gray-100"><tr>
      <th class="px-4 py-2 border">Email</th>
      <th class="px-4 py-2 border">Role</th>
      <th class="px-4 py-2 border">Action</th>
    </tr></thead><tbody>`;
  users.forEach((u,index)=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${u.email}</td>
      <td class="px-4 py-2">${u.role}</td>
      <td class="px-4 py-2">
        ${currentUser.role==='admin' && u.email!==currentUser.email ? `<button onclick="deleteUser('${u.email}')" class="px-2 py-1 text-white bg-red-600 rounded hover:bg-red-700">Delete</button>` : ''}
      </td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

async function addUser() {
  const email = document.getElementById('new-user-email').value.trim();
  const role = document.getElementById('new-user-role').value;
  if(!email){ alert('Enter email'); return; }

  try {
    const res = await fetch(`${API_URL}/users`, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ email, role, username: email.split('@')[0], password: '123456', adminEmail: currentUser.email })
    });
    const data = await res.json();
    if(data.success){ fetchUsers(); } 
    else { alert(data.message); }
  } catch(err){ console.error(err); }
}

async function deleteUser(email) {
  if(!confirm('Are you sure you want to delete this user?')) return;
  try {
    const res = await fetch(`${API_URL}/users/${email}`, {
      method:'DELETE',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ adminEmail: currentUser.email })
    });
    const data = await res.json();
    if(data.success){ fetchUsers(); } 
    else { alert(data.message); }
  } catch(err){ console.error(err); }
}

// ================== VOUCHERS ==================
function renderVouchersPage() {
  setActiveTab('nav-vouchers');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Vouchers</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="voucher-name" placeholder="Voucher Name" class="border px-3 py-2 rounded-lg">
      <input type="number" id="voucher-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addVoucher()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Voucher</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Name</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  vouchers.forEach(v=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${v.name}</td>
      <td class="px-4 py-2">TZS ${v.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addVoucher() {
  const name = document.getElementById('voucher-name').value.trim();
  const amount = parseFloat(document.getElementById('voucher-amount').value);
  if(!name || isNaN(amount)){ alert('Fill all fields'); return; }
  vouchers.push({name,amount});
  renderVouchersPage();
}

// ================== JOURNALS ==================
function renderJournalsPage() {
  setActiveTab('nav-journals');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Journals</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="journal-name" placeholder="Journal Entry" class="border px-3 py-2 rounded-lg">
      <input type="number" id="journal-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addJournal()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Add Journal</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Entry</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  journals.forEach(j=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${j.entry}</td>
      <td class="px-4 py-2">TZS ${j.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addJournal() {
  const entry = document.getElementById('journal-name').value.trim();
  const amount = parseFloat(document.getElementById('journal-amount').value);
  if(!entry || isNaN(amount)){ alert('Fill all fields'); return; }
  journals.push({entry,amount});
  renderJournalsPage();
}

</script>

</body>
</html>        <div>
          <h1 class="text-2xl font-bold text-gray-800">Makungu Group</h1>
          <p class="text-sm text-gray-500">Financial System</p>
        </div>
      </div>
      <nav class="flex-1 p-4 space-y-1">
        <button id="nav-dashboard" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-home text-gray-500"></i><span>Dashboard</span>
        </button>
        <button id="nav-vouchers" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-receipt text-gray-500"></i><span>Vouchers</span>
        </button>
        <button id="nav-journals" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-book text-gray-500"></i><span>Journals</span>
        </button>
        <button id="nav-users" class="tab-btn w-full text-left px-4 py-3 rounded-lg flex items-center space-x-3 hover:bg-blue-50 transition">
          <i class="fas fa-users text-gray-500"></i><span>Users</span>
        </button>
      </nav>
      <div class="p-4 border-t">
        <div class="mb-2 px-2 text-sm text-gray-600">
          <i class="fas fa-user-circle mr-1"></i> Logged in as <span id="user-email-display"></span> (<span id="user-role-display"></span>)
        </div>
        <button id="logout-btn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg flex items-center space-x-3">
          <i class="fas fa-sign-out-alt"></i><span>Logout</span>
        </button>
      </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
      <div id="content-area"></div>
    </main>
  </div>
</div>

<!-- BACKEND-CONNECTED SCRIPT -->
<script>
const API_URL = 'https://makungu-backend-v2.onrender.com/api';

let currentUser = null;
let users = [];
let vouchers = [];
let journals = [];

// ================== LOGIN ==================
function showApp() {
  document.getElementById('login-container').classList.add('hidden');
  document.getElementById('app-container').classList.remove('hidden');
  document.getElementById('user-email-display').innerText = currentUser.email;
  document.getElementById('user-role-display').innerText = currentUser.role;
  renderDashboard();
  fetchUsers();
}

function showLogin() {
  document.getElementById('login-container').classList.remove('hidden');
  document.getElementById('app-container').classList.add('hidden');
  currentUser = null;
}

document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  try {
    const res = await fetch(`${API_URL}/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (data.success) {
      currentUser = data.user;
      showApp();
    } else {
      alert(data.message || 'Invalid credentials');
    }
  } catch(err) {
    console.error(err);
    alert('Login failed');
  }
});

document.getElementById('logout-btn').addEventListener('click', showLogin);

// ================== NAVIGATION ==================
document.getElementById('nav-dashboard').addEventListener('click', renderDashboard);
document.getElementById('nav-users').addEventListener('click', renderUsersPage);
document.getElementById('nav-vouchers').addEventListener('click', renderVouchersPage);
document.getElementById('nav-journals').addEventListener('click', renderJournalsPage);

function clearActiveTab(){
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
}
function setActiveTab(tabId){
  clearActiveTab();
  document.getElementById(tabId).classList.add('active');
}

// ================== DASHBOARD ==================
function renderDashboard() {
  setActiveTab('nav-dashboard');
  document.getElementById('content-area').innerHTML = `
    <h2 class="text-3xl font-bold mb-4">Dashboard</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Users</h3>
        <p class="text-2xl font-bold">${users.length}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Vouchers</h3>
        <p class="text-2xl font-bold">${vouchers.length}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Journals</h3>
        <p class="text-2xl font-bold">${journals.length}</p>
      </div>
    </div>
  `;
}

// ================== USERS ==================
async function fetchUsers() {
  if (currentUser.role !== 'admin') return;
  try {
    const res = await fetch(`${API_URL}/users?adminEmail=${currentUser.email}`);
    users = await res.json();
    renderUsersPage();
  } catch(err){ console.error(err); }
}

function renderUsersPage() {
  setActiveTab('nav-users');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Users Management</h2>`;
  if(currentUser.role==='admin'){
    html += `
      <div class="mb-4 flex space-x-2">
        <input type="email" id="new-user-email" placeholder="Email" class="border px-3 py-2 rounded-lg">
        <select id="new-user-role" class="border px-3 py-2 rounded-lg">
          <option value="staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
        <button onclick="addUser()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add User</button>
      </div>`;
  }
  html += `<table class="w-full text-left border rounded-lg overflow-hidden">
    <thead class="bg-gray-100"><tr>
      <th class="px-4 py-2 border">Email</th>
      <th class="px-4 py-2 border">Role</th>
      <th class="px-4 py-2 border">Action</th>
    </tr></thead><tbody>`;
  users.forEach((u,index)=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${u.email}</td>
      <td class="px-4 py-2">${u.role}</td>
      <td class="px-4 py-2">
        ${currentUser.role==='admin' && u.email!==currentUser.email ? `<button onclick="deleteUser('${u.email}')" class="px-2 py-1 text-white bg-red-600 rounded hover:bg-red-700">Delete</button>` : ''}
      </td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

async function addUser() {
  const email = document.getElementById('new-user-email').value.trim();
  const role = document.getElementById('new-user-role').value;
  if(!email){ alert('Enter email'); return; }

  try {
    const res = await fetch(`${API_URL}/users`, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ email, role, username: email.split('@')[0], password: '123456', adminEmail: currentUser.email })
    });
    const data = await res.json();
    if(data.success){ fetchUsers(); } 
    else { alert(data.message); }
  } catch(err){ console.error(err); }
}

async function deleteUser(email) {
  if(!confirm('Are you sure you want to delete this user?')) return;
  try {
    const res = await fetch(`${API_URL}/users/${email}`, {
      method:'DELETE',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ adminEmail: currentUser.email })
    });
    const data = await res.json();
    if(data.success){ fetchUsers(); } 
    else { alert(data.message); }
  } catch(err){ console.error(err); }
}

// ================== VOUCHERS ==================
function renderVouchersPage() {
  setActiveTab('nav-vouchers');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Vouchers</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="voucher-name" placeholder="Voucher Name" class="border px-3 py-2 rounded-lg">
      <input type="number" id="voucher-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addVoucher()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Voucher</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Name</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  vouchers.forEach(v=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${v.name}</td>
      <td class="px-4 py-2">TZS ${v.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addVoucher() {
  const name = document.getElementById('voucher-name').value.trim();
  const amount = parseFloat(document.getElementById('voucher-amount').value);
  if(!name || isNaN(amount)){ alert('Fill all fields'); return; }
  vouchers.push({name,amount});
  renderVouchersPage();
}

// ================== JOURNALS ==================
function renderJournalsPage() {
  setActiveTab('nav-journals');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Journals</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="journal-name" placeholder="Journal Entry" class="border px-3 py-2 rounded-lg">
      <input type="number" id="journal-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addJournal()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Add Journal</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Entry</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  journals.forEach(j=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${j.entry}</td>
      <td class="px-4 py-2">TZS ${j.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addJournal() {
  const entry = document.getElementById('journal-name').value.trim();
  const amount = parseFloat(document.getElementById('journal-amount').value);
  if(!entry || isNaN(amount)){ alert('Fill all fields'); return; }
  journals.push({entry,amount});
  renderJournalsPage();
}

</script>

</body>
</html>  document.getElementById(tabId).classList.add('active');
}

// ================== DASHBOARD ==================
let vouchers = [];
let journals = [];

function renderDashboard(){
  setActiveTab('nav-dashboard');
  const totalUsers = document.getElementById('content-area').dataset.totalUsers || 0;
  const totalVouchers = vouchers.length;
  const totalJournals = journals.length;
  document.getElementById('content-area').innerHTML = `
    <h2 class="text-3xl font-bold mb-4">Dashboard</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Users</h3>
        <p class="text-2xl font-bold">${totalUsers}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Vouchers</h3>
        <p class="text-2xl font-bold">${totalVouchers}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow card-hover">
        <h3 class="text-gray-500 text-sm">Total Journals</h3>
        <p class="text-2xl font-bold">${totalJournals}</p>
      </div>
    </div>
  `;
}

// ================== USERS ==================
async function fetchUsers(){
  try {
    const res = await fetch(`${BASE_URL}/api/users?adminEmail=${currentUser.email}`);
    const data = await res.json();
    if(Array.isArray(data)){
      return data;
    } else {
      alert(data.message || 'Failed to fetch users');
      return [];
    }
  } catch(err){
    alert('Server error: ' + err);
    return [];
  }
}

async function renderUsersPage(){
  setActiveTab('nav-users');
  let users = [];
  if(currentUser.role==='admin'){
    users = await fetchUsers();
  }

  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Users Management</h2>`;
  
  if(currentUser.role==='admin'){
    html += `
      <div class="mb-4 flex space-x-2">
        <input type="email" id="new-user-email" placeholder="Email" class="border px-3 py-2 rounded-lg">
        <select id="new-user-role" class="border px-3 py-2 rounded-lg">
          <option value="staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
        <button onclick="addUser()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add User</button>
      </div>`;
  }

  html += `<table class="w-full text-left border rounded-lg overflow-hidden">
    <thead class="bg-gray-100"><tr>
      <th class="px-4 py-2 border">Email</th>
      <th class="px-4 py-2 border">Role</th>
      <th class="px-4 py-2 border">Action</th>
    </tr></thead><tbody>`;
  
  users.forEach(u=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${u.email}</td>
      <td class="px-4 py-2">${u.role}</td>
      <td class="px-4 py-2">
        ${currentUser.role==='admin' && u.email!==currentUser.email ?`<button onclick="deleteUser('${u.email}')" class="px-2 py-1 text-white bg-red-600 rounded hover:bg-red-700">Delete</button>`:''}
      </td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

async function addUser(){
  const email = document.getElementById('new-user-email').value.trim();
  const role = document.getElementById('new-user-role').value;
  if(!email){ alert('Enter email'); return; }

  try {
    const res = await fetch(`${BASE_URL}/api/users`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email, role, adminEmail: currentUser.email, password:'password123' })
    });
    const data = await res.json();
    if(data.success){
      renderUsersPage();
    } else {
      alert(data.message || 'Failed to add user');
    }
  } catch(err){
    alert('Server error: ' + err);
  }
}

async function deleteUser(email){
  if(!confirm('Are you sure you want to delete this user?')) return;

  try {
    const res = await fetch(`${BASE_URL}/api/users/${email}`, {
      method:'DELETE',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ adminEmail: currentUser.email })
    });
    const data = await res.json();
    if(data.success){
      renderUsersPage();
    } else {
      alert(data.message || 'Failed to delete user');
    }
  } catch(err){
    alert('Server error: ' + err);
  }
}

// ================== VOUCHERS ==================
function renderVouchersPage(){
  setActiveTab('nav-vouchers');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Vouchers</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="voucher-name" placeholder="Voucher Name" class="border px-3 py-2 rounded-lg">
      <input type="number" id="voucher-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addVoucher()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Voucher</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Name</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  vouchers.forEach(v=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${v.name}</td>
      <td class="px-4 py-2">TZS ${v.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addVoucher(){
  const name = document.getElementById('voucher-name').value.trim();
  const amount = parseFloat(document.getElementById('voucher-amount').value);
  if(!name || isNaN(amount)){ alert('Fill all fields'); return; }
  vouchers.push({name,amount});
  renderVouchersPage();
}

// ================== JOURNALS ==================
function renderJournalsPage(){
  setActiveTab('nav-journals');
  let html = `<div>
    <h2 class="text-2xl font-bold mb-4">Journals</h2>
    <div class="mb-4 flex space-x-2">
      <input type="text" id="journal-name" placeholder="Journal Entry" class="border px-3 py-2 rounded-lg">
      <input type="number" id="journal-amount" placeholder="Amount (TZS)" class="border px-3 py-2 rounded-lg">
      <button onclick="addJournal()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Add Journal</button>
    </div>
    <table class="w-full text-left border rounded-lg overflow-hidden">
      <thead class="bg-gray-100"><tr>
        <th class="px-4 py-2 border">Entry</th>
        <th class="px-4 py-2 border">Amount (TZS)</th>
      </tr></thead><tbody>`;
  journals.forEach(j=>{
    html += `<tr class="border-b">
      <td class="px-4 py-2">${j.entry}</td>
      <td class="px-4 py-2">TZS ${j.amount.toLocaleString()}</td>
    </tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('content-area').innerHTML = html;
}

function addJournal(){
  const entry = document.getElementById('journal-name').value.trim();
  const amount = parseFloat(document.getElementById('journal-amount').value);
  if(!entry || isNaN(amount)){ alert('Fill all fields'); return; }
  journals.push({entry,amount});
  renderJournalsPage();
}
</script>
